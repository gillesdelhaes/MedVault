<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MedVault</title>
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
  <link rel="stylesheet" href="/css/variables.css" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/calendar.css" />
</head>
<body>

<!-- Setup wizard (shown on first run only) -->
<div id="setup-page" style="display:none">
  <div id="setup-bg" style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--color-bg)">
    <div class="login-card" style="max-width:440px">
      <h1 style="text-align:center;color:var(--color-primary);margin-bottom:var(--space-2)">
        <svg width="32" height="32" viewBox="0 0 32 32" style="vertical-align:middle;margin-right:8px">
          <rect width="32" height="32" rx="6" fill="#4A6FA5"/>
          <path d="M16 6 L16 26 M6 16 L26 16" stroke="white" stroke-width="4" stroke-linecap="round"/>
        </svg>
        MedVault
      </h1>
      <p class="subtitle" style="text-align:center;color:var(--color-text-muted);margin-bottom:var(--space-6)">Welcome! Let's get you set up.</p>

      <div style="background:var(--color-primary-light);border-radius:var(--radius-md);padding:var(--space-4);margin-bottom:var(--space-6);font-size:0.875rem;color:var(--color-primary)">
        This is a one-time setup. Your encryption key and signing secret have already been generated automatically and saved securely.
        All you need is a password to protect access to the app.
      </div>

      <form id="setup-form">
        <div class="form-group">
          <label class="form-label required" for="setup-password">Choose a password</label>
          <input type="password" id="setup-password" class="form-input" autocomplete="new-password" required minlength="8" autofocus />
          <div style="margin-top:6px">
            <div style="height:4px;background:var(--color-border);border-radius:2px;overflow:hidden">
              <div id="pw-strength-bar" style="height:100%;width:0;transition:width 0.3s,background 0.3s;border-radius:2px"></div>
            </div>
            <span id="pw-strength-label" style="font-size:0.75rem;color:var(--color-text-muted)"></span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label required" for="setup-password2">Confirm password</label>
          <input type="password" id="setup-password2" class="form-input" autocomplete="new-password" required minlength="8" />
        </div>
        <span class="form-error" id="setup-error" style="display:none;margin-bottom:8px;display:none"></span>
        <button type="submit" class="btn btn--primary" style="width:100%;justify-content:center;margin-top:var(--space-4)" id="setup-btn">
          Create password &amp; get started
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Login page (shown when not authenticated) -->
<div id="login-page" style="display:none">
  <div class="login-card">
    <h1>
      <svg width="32" height="32" viewBox="0 0 32 32" style="vertical-align:middle;margin-right:8px">
        <rect width="32" height="32" rx="6" fill="#4A6FA5"/>
        <path d="M16 6 L16 26 M6 16 L26 16" stroke="white" stroke-width="4" stroke-linecap="round"/>
      </svg>
      MedVault
    </h1>
    <p class="subtitle">Family medical tracker</p>
    <form id="login-form">
      <div class="form-group">
        <label class="form-label required" for="password">Password</label>
        <input
          type="password"
          id="password"
          class="form-input"
          autocomplete="current-password"
          required
          autofocus
        />
        <span class="form-error" id="login-error" style="display:none"></span>
      </div>
      <button type="submit" class="btn btn--primary" style="width:100%;justify-content:center;margin-top:8px" id="login-btn">
        Sign in
      </button>
    </form>
  </div>
</div>

<!-- App shell (shown when authenticated) -->
<div id="shell" style="display:none">
  <nav id="nav">
    <div id="nav-brand">
      <svg width="24" height="24" viewBox="0 0 32 32">
        <rect width="32" height="32" rx="6" fill="#4A6FA5"/>
        <path d="M16 6 L16 26 M6 16 L26 16" stroke="white" stroke-width="4" stroke-linecap="round"/>
      </svg>
      MedVault
    </div>
    <button id="nav-toggle" aria-label="Toggle menu">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
    <ul id="nav-links">
      <li>
        <a href="#/calendar" data-route="/calendar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Calendar
        </a>
      </li>
      <li>
        <a href="#/patients" data-route="/patients">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          Patients
        </a>
      </li>
      <li>
        <a href="#/appointments" data-route="/appointments">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12a19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 3.6 1.27h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.82a16 16 0 0 0 6.29 6.29l.98-.98a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
          Appointments
        </a>
      </li>
      <li>
        <a href="#/symptoms" data-route="/symptoms">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          Symptoms
        </a>
      </li>
      <li>
        <a href="#/medications" data-route="/medications">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/>
            <line x1="8.5" y1="8.5" x2="15.5" y2="15.5"/>
          </svg>
          Medications
        </a>
      </li>
      <li>
        <a href="#/search" data-route="/search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          Search
        </a>
      </li>
    </ul>
    <div id="nav-footer">
      <button class="btn btn--ghost" id="logout-btn" style="width:100%;justify-content:center">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        Logout
      </button>
    </div>
  </nav>

  <main id="app">
    <div class="loading">
      <div class="spinner"></div> Loadingâ€¦
    </div>
  </main>
</div>

<!-- Toast container -->
<div id="toast-container"></div>

<!-- Scripts -->
<script src="/js/components/toast.js"></script>
<script src="/js/components/modal.js"></script>
<script src="/js/components/patientBadge.js"></script>
<script src="/js/api.js"></script>
<script src="/js/views/setup.js"></script>
<script src="/js/views/login.js"></script>
<script src="/js/views/calendar.js"></script>
<script src="/js/views/patients.js"></script>
<script src="/js/views/appointments.js"></script>
<script src="/js/views/symptoms.js"></script>
<script src="/js/views/medications.js"></script>
<script src="/js/views/search.js"></script>
<script src="/js/app.js"></script>
</body>
</html>
